# Setting up a Parrot template in Qubes

I previously used a template based on Kali Linux. However Kali is a rolling distribution which will cause issues with packages breaking.

To avoid breakage when updating, the core Qubes packages should be on hold.
This means that they will not be updated. A better option in my opinion is using Parrot.

## Getting Umnans pgp key

All files are signed with Umnans Qubes OS Signing key.  
You'll need to get this from a keyserver, or two, to make sure all is fine:  
[keyserver.ubuntu.com](https://keyserver.ubuntu.com/pks/lookup?search=0x8B3F30F9C8C0C2EF&fingerprint=on&op=index)  

```
pub   rsa4096 2016-06-25 [SC]
      4B1F 400D F256 51B5 3C41  41B3 8B3F 30F9 C8C0 C2EF
uid           [ unknown] unman (Qubes OS signing key) 
sub   rsa4096 2016-06-27 [S] [expires: 2026-06-30]
sub   rsa4096 2016-06-25 [E]
```
  
You can also check the Qubes users mailing list or look on [github](https://github.com/unman/unman).

Once you have copies of the key, check the fingerprint:

`gpg -n --import --import-options import-show _unman.pub_`

replacing _unman.pub_ with the path to the key. Once you are satisfied that you have a genuine key, you can use it to validate the packages.

You will need to copy the key in to dom0:  
`qvm-run -p qube 'cat PATH_TO_KEY ' > RPM-GPG-KEY-unman`  
and then move it into place:  
`sudo mv RPM-GPG-KEY-unman /etc/qubes/repo-templates/keys/RPM-GPG-KEY-unman`
## Download template

The template we are going to use is located at https://qubes.3isec.org/Templates_4.3/.

Download the Parrot OS template to a temporary location.

## Verifying fingerprint

Check the signature before copying the package to dom0 by (e.g):  
`rpm -qi TEMPLATE_PACKAGE_NAME`  
This will show you the key that signed the package, and this should be the same as the short keyID of the unman key.


## Installing template

To install the template we need to copy it into dom0:  

`qvm-run -p QUBE 'cat PATH_TO_DOWNLOADED_TEMPLATE ' > TEMPLATE_PACKAGE_NAME`  

replacing `TEMPLATE_PACKAGE_NAME` with a name of your choice.  

  
Install the template using qvm-template in dom0:  
`qvm-template --keyring /etc/qubes/repo-templates/keys/RPM-GPG-KEY-unman install FULL_PATH_TO_DOWNLOADED_TEMPLATE`  

The qvm-template call will check that the package is signed by the key you specify.
